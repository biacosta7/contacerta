<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        {% load static %}
        
        {% block css %}
        {% endblock css %}

        <title>ContaCerta | {% block title %}{% endblock %}</title>
        <script src="https://cdn.tailwindcss.com"></script>

        <link rel="stylesheet" href="https://unpkg.com/flowbite@1.4.4/dist/flowbite.min.css" />
        <script src="https://unpkg.com/imask"></script>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

        <link rel="stylesheet" href="https://unpkg.com/flowbite@1.4.4/dist/flowbite.min.css" />

        <!-- dropdown com busca -->
        <script src="https://cdn.jsdelivr.net/npm/tom-select@2.0.0/dist/js/tom-select.complete.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/tom-select@2.0.0/dist/css/tom-select.css" rel="stylesheet" />
   

    </head>
    <body>
        {% block content %}{% endblock content %}
        <script src="https://kit.fontawesome.com/d774daea05.js" crossorigin="anonymous"></script>
    </body>
    <script>
        const obras = JSON.parse('{{ obras_json|safe }}');
        console.log('Obras carregadas:', obras);

        function ToBRCurrency(ElementID, valor){
            const input = document.getElementById(ElementID);
            let numero = valor; 
        
            // Verifica se o valor não está vazio
            if (input) {
                console.log(numero);
                // Converte para número e formata no formato pt-BR
                numero = Number(numero).toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
                });
                console.log(numero);
                // Atualiza o valor no campo de entrada
                input.value = numero;
            } else {
                console.log("Não há valor inicial.");
            }
        
            // Aplica a máscara para permitir edição no formato brasileiro
            IMask(input, {
                mask: Number, // Tipo de máscara
                scale: 2, // Casas decimais
                signed: false, // Valores negativos
                thousandsSeparator: '.', // Separador de milhar
                padFractionalZeros: true, // Preencher zeros após a vírgula
                normalizeZeros: true, // Remover zeros desnecessários
                radix: ',', // Separador decimal
            });
        }

        //Modal de formulário
        function modalformCriacao(action, { modalName, formId, hiddenClass = 'hidden', currencyFields = [] } = {}) {
            const modal = document.getElementById(modalName);
            const form = formId ? document.getElementById(formId) : null;
        
            if (!modal) {
                console.error(`Modal com ID "${modalName}" não encontrado.`);
                return;
            }
        
            if (action === 'abrir') {
                modal.classList.toggle(hiddenClass);
                if (form) form.reset();
        
                // Se currencyFields for um array e contiver valores, aplica ToBRCurrency
                if (Array.isArray(currencyFields) && currencyFields.length > 0) {
                    currencyFields.forEach(field => {
                        const element = document.getElementById(field);
                        if (element) ToBRCurrency(field, 0);
                    });
                }
            } else if (action === 'fechar') {
                modal.classList.add(hiddenClass);
            } else {
                console.warn(`Ação "${action}" não reconhecida.`);
            }
        }
        

    </script>
    {% block script %}
    {% endblock script %}
</html>