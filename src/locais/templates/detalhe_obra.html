{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhes - {{ obra.nome }}{% endblock %}

{% block content %}
<div class="border-b-4 h-full mb-10">
    <div class="flex flex-col h-full w-full max-w-2xl sm:max-w-4xl lg:max-w-6xl mx-auto">
        <div class="flex w-full p-4 items-center">
            <!-- Ícone de seta para voltar -->
            <a href={% url 'home' %}><i class="fa-solid fa-arrow-left fa-xl p-3 pt-3.5 pb-3.5 ml-4 mr-10 flex-grow-0"></i></a>
            
            <!-- Div principal com flex-grow-1 -->
            <div class="flex flex-grow items-center">
                <!-- Conteúdo alinhado à esquerda -->
                <div class="border-l-4 border-gray-200 px-4 flex-grow">
                    <h1 class="text-2xl font-bold mb-2">Obra {{ obra.nome }}</h1>
                    <div>
                        <p class="text-sm break-words mb-2 text-lg">
                            <i class="fa-solid fa-location-dot fa-xl px-1"></i> {{ obra.local }}
                        </p>
                        <p id="valorInicialObraInfo" class="text-sm break-words text-lg">
                            <i class="fa-solid fa-dollar-sign mr-1"></i> R${{ obra.valor_inicial }}
                        </p>
                    </div>
                </div>
            </div>
        
            <!-- Ícone de opções no canto direito -->
            <i class="fa-solid fa-ellipsis-vertical fa-xl p-3 pt-3.5 pb-3.5 rounded-[9px] mr-4 flex-grow-0"></i>
        </div>
        

        <div class="flex mt-4 items-center justify-center text-center w-full space-x-20">
            <button id="geralBtn" class="px-8 py-2 text-center bg-gray-200 rounded-t-[9px]" onclick="sectionModal('geralSection')">Geral</button>
            <button id="aditivosBtn" class="px-8 py-2 text-center rounded-t-[9px]" onclick="sectionModal('aditivosSection')">Aditivos</button>
            <button id="adiabmBtn" class="px-8 py-2 text-center rounded-t-[9px]" onclick="sectionModal('adiabmSection')">Adiantamentos/BMs</button>
            <button id="despesasBtn" class="px-8 py-2 text-center rounded-t-[9px]" onclick="sectionModal('despesasSection')">Despesas</button>
        </div>
    </div>
</div>
<div class="flex flex-col w-full max-w-2xl sm:max-w-4xl lg:max-w-6xl mx-auto justify-center items-center">
    <div id="geralSection" class="hidden"> <!-- Inicialmente visível -->
        {% include "modais/menuObra/geral_obra.html" %}
    </div>
    <div id="aditivosSection" class="hidden">
        {% include "modais/menuObra/aditivos.html" %}
    </div>
    <div id="adiabmSection" class="hidden">
        {% include "modais/menuObra/adiantamentos_bms.html" %}
    </div>
    <div id="despesasSection" class="block">
        {% include "modais/menuObra/despesas_obra.html" %}
    </div>
</div>

{% endblock content %}

{% block script %}
<script>
    // Obtenha o caminho completo da URL
    const path = window.location.pathname;

    // Divida o caminho em partes usando '/' como separador
    const pathParts = path.split('/');

    // O ID está na última parte do caminho
    const obraId = parseInt(pathParts[pathParts.length - 1], 10);

    let obra = obras.find(o => o.id === obraId);

    document.getElementById('valorInicialObraInfo').innerHTML = 
    `<i class="fa-solid fa-dollar-sign mr-1 bg-gray-800 py-1 px-2 rounded-full" style="color:rgb(255, 255, 255);"></i> <b>Valor inicial:</b> R$ ${new Intl.NumberFormat('pt-BR', { 
        style: 'decimal', 
        minimumFractionDigits: 2, 
        maximumFractionDigits: 2 
    }).format(obra.valor_inicial)}`;

    function sectionModal(action) {
        const sections = ["geralSection", "aditivosSection", "despesasSection", "adiabmSection"];
        const buttons = [ "geralBtn", "aditivosBtn", "despesasBtn", "adiabmBtn"]

        // Oculta todas as seções
        sections.forEach(section => {
            document.getElementById(section).classList.add("hidden");
        });
    
        // Mostra apenas a seção correspondente
        document.getElementById(action).classList.remove("hidden");


        // Remove a classe bg-gray-200 de todos os botões
        buttons.forEach(button => {
            document.getElementById(button).classList.remove("bg-gray-200");
        });

        // Adiciona a classe bg-gray-200 ao botão selecionado
        const selectedButton = `${action.replace("Section", "Btn")}`;
        document.getElementById(selectedButton).classList.add("bg-gray-200");
    }    

</script>
{% endblock script %}